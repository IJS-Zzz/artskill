{% extends "catalogue/browse.html" %}

{% load find_parent_tags %}

{% load i18n %}

{% block title %}
    {{ shop_name }} - {{ category.name }}
{% endblock %}

{% block description %}
    {{ category.description|default:""|striptags }}
{% endblock %}

{% block header %}
    <div class="page-header action">
        {% if user.is_staff %}
            <a class="pull-right hidden-xs" href="{% url 'dashboard:catalogue-category-update' pk=category.id %}">
                <small><i class="icon-edit"></i> {% trans "Edit this category" %}</small>
            </a>
        {% endif %}
        <h1>{% block headertext %}{{ category.name }}{% endblock %}</h1>
    </div>
{% endblock %}

{% block breadcrumbs %}

    <div class="col-sm-1"></div>
    <div class="col-sm-11">
        <ul class="breadcrumb">
            <li>
                <a href="{% url 'catalogue:index' %}">Каталог товаров</a>
            </li>
            {% for category in category.get_ancestors %}
                <li>
                    <a href="{{ category.get_absolute_url }}">{{ category.name }}</a>
                </li>
            {% endfor %}
            <li class="active">{{ category.name }}</li>
        </ul>
    </div>

{% endblock breadcrumbs %}


{% block content %}


    <div class="col-sm-1"></div>
    <div class="col-sm-11">
        <h2 class="category-heading t-align_left" style="margin: 20px 0">{{ category.name }}</h2>
    </div>


    {% for product in products %}
        <div class="col-sm-3">

            <a href="{{ product.get_absolute_url }}">
                <div class="box">
                    <div class='aspect-ratio grey bcgi category-hover{{ forloop.counter0 }}'>

                        <div class="item-opt col-sm-12">

                            <div class="item-opt-colours col-sm-6">
                                {# Colors Panel #}
                                {% get_product_parent product as product_parent %}
                                {% if product_parent.can_be_parent and product_parent.use_colors %}
                                    {% for child in product_parent.children.all %}
                                        <p class="item-circle" style="
                                                background:
                                                {% if child.color %}{{ child.color }}{% else %}#eeeeee{% endif %};"></p>
                                    {% endfor %}
                                {% endif %}
                            </div>

                            <div class="item-opt-like col-sm-6" style="text-align: right;">
                                {% load display_tags %}
                                {% iffeature "wishlists" %}
                                    {% include "catalogue/partials/add_to_first_wishlist_min.html" %}
                                {% endiffeature %}
                            </div>

                        </div>

                        <div class="item-descr">
                            <h4>{{ product }}</h4>
                            <p>{{ product_parent.get_product_class.name }}</p>

                            <p class="price">
                                {% block product_stock_record %}
                                    {% include "catalogue/partials/stock_record.html" with verbose=1 %}
                                {% endblock %}
                            </p>
                        </div>

                    </div>

                    {% with all_images=product.get_all_images %}
                        <style>
                            .category-hover{{ forloop.counter0 }} {
                                background-image: url('{{ all_images.0.original.url }}');
                            }

                            .category-hover{{ forloop.counter0 }}:hover {
                                background-image: url('{{ all_images.1.original.url }}');
                            }

                            .category-hover{{ forloop.counter0 }}:hover .item-opt {
                                display: block;
                            }
                        </style>
                    {% endwith %}

                </div>
            </a>
        </div>
    {% endfor %}


{% endblock %}
